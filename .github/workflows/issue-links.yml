name: Issue Links

on:
  pull_request:
    types: [opened, edited]

jobs:
  link-issues:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
    steps:
      - name: Link PR to Issues
        uses: actions/github-script@v7
        with:
          script: |
            const body = context.payload.pull_request.body || '';
            const issueRefs = body.match(/#(\d+)/g) || [];

            for (const ref of issueRefs) {
              const issueNum = ref.replace('#', '');
              // Add comment linking PR to issue
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: parseInt(issueNum),
                body: `PR #${context.payload.pull_request.number} references this issue.`
              });
            }
